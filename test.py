from scapy.all import *


#arp_mitm("192.168.122.156", "192.168.122.17")

#sniff(iface="eth0", prn=lambda x:x.sprintf("{Dot11Beacon:%Dot11.addr3%\t%Dot11Beacon.info%\t%PrismHeader.channel%\t%Dot11Beacon.cap%}"))

def handlePacket(packet):
    print("HALLO!")
    if "UDP" in packet: # and packet[IP].dst == "10.223.20.43:1543": #change ip as required
        #print(packet[UDP].payload.show())
        #print(packet.summary())
        '''newThingyThatsRequiredForSomeReason =  bytearray([60,88,77,76,68,105,115,112,108,97,121,68,97,116,97,32,78,97,109,101,61,34,77,111,99,107,68,105,115,112,108,97,121,34,32,80,97,116,104,61,34,71,114,97,112,104,105,99,115,46,68,105,115,112,108,97,121,115,34,32,83,99,104,101,109,97,86,101,114,115,105,111,110,61,34,49,46,49,46,49,46,50,34,62,10,32,32,60,77,101,116,97,100,97,116,97,62,10,32,32,32,32,60,76,97,115,116,69,100,105,116,85,115,101,114,62,68,86,65,68,77,73,78,60,47,76,97,115,116,69,100,105,116,85,115,101,114,62,10,32,32,32,32,60,76,97,115,116,69,100,105,116,84,105,109,101,62,50,48,50,52,45,48,54,45,50,54,84,49,57,58,53,48,58,49,55,46,55,53,55,50,43,48,48,58,48,48,60,47,76,97,115,116,69,100,105,116,84,105,109,101,62,10,32,32,60,47,77,101,116,97,100,97,116,97,62,10,32,32,60,80,111,108,121,103,111,110,32,78,97,109,101,61,34,67,111,110,116,114,111,108,80,111,108,121,103,111,110,34,62,10,32,32,32,32,60,72,101,105,103,104,116,62,10,32,32,32,32,32,32,60,86,97,108,117,101,62,49,60,47,86,97,108,117,101,62,10,32,32,32,32,60,47,72,101,105,103,104,116,62,10,32,32,32,32,60,87,105,100,116,104,62,10,32,32,32,32,32,32,60,86,97,108,117,101,62,49,60,47,86,97,108,117,101,62,10,32,32,32,32,60,47,87,105,100,116,104,62,10,32,32,32,32,60,88,62,10,32,32,32,32,32,32,60,86,97,108,117,101,62,49,60,47,86,97,108,117,101,62,10,32,32,32,32,60,47,88,62,10,32,32,32,32,60,89,62,10,32,32,32,32,32,32,60,86,97,108,117,101,62,49,60,47,86,97,108,117,101,62,10,32,32,32,32,60,47,89,62,10,32,32,60,47,80,111,108,121,103,111,110,62,10,32,32,60,79,112,101,114,97,116,105,110,103,80,101,114,99,101,110,116,97,103,101,62,49,60,47,79,112,101,114,97,116,105,110,103,80,101,114,99,101,110,116,97,103,101,62,10,32,32,60,85,110,114,101,115,111,108,118,101,100,73,115,115,117,101,115,62,49,48,48,48,48,60,47,85,110,114,101,115,111,108,118,101,100,73,115,115,117,101,115,62,10,60,47,88,77,76,68,105,115,112,108,97,121,68,97,116,97,62])
        #packet[UDP].payload = newThingyThatsRequiredForSomeReason
        packet = IP()/UDP()/Raw(load=newThingyThatsRequiredForSomeReason)

        del packet[IP].chksum
        del packet[UDP].chksum
        send(packet)'''



print("started")
capture = sniff(prn=handlePacket, count=1)
print("post")
#capture = sniff(count=1)
print(capture.summary)
wrpcap("joeobama.pcap", capture)





def handlePacket(packet):
    if "UDP" in packet: # and packet[IP].dst == "10.223.20.43:1543": #change ip as required
        #print(packet[UDP].payload.show())
        #packet.remove_payload()[UDP].payload.show()
        #scapy.packet.Packet(packet2).add_payload(b'\x01\x02\x03\x04\x05')
        #print(packet2[UDP].payload.show())
        '''packet.load = b'\x01'
        del packet[IP].chksum
        del packet[UDP].chksum'''
        for i in range(1000):
            send(packet)
        print(packet[UDP].payload.show())
        #for i in range(1000):
        '''
        send(packet)
        print("hehe sent again!!!!!")
        print(packet.summary())'''


packets = sniff(iface='Wi-Fi', timeout=25, prn=handlePacket)
print (str(packets))
